ホームページ
==============

注意:jekyllを無効にしています．
普通のサイトを作りたい場合は，jekyllを有効にした方がよいです．

Caution: I disabled jekyll.
You should enable jekyll to create a normal web site.

リンク(Link)
------------

トップページ(Top Page)
- [https://guiltycat.github.io/](https://guiltycat.github.io/)

サイトマップ(Site Map)
- [https://guiltycat.github.io/sitemap.xml](https://guiltycat.github.io/sitemap.xml)

使い方
================

`diary.bash`を使うと，自動で今日の日付から記事の名前を生成し，
`nvim`で開けてくれる．

そして，`upload.bash`でMarkdownから自動でhtmlが生成され，自動でアップロードされる．

日々使うのはこの二つのコマンドだけだ．

`diary.bash` creates today's article Markdown file and open  by `nvim`.
`upload.bash` generate html file and upload to GitHub automatically.

I use these two commands to write and upload articles.

ディレクトリの構成
=============

md
------------

全ての記事のMarkdownが入っている．

ファイル名はそのファイルを作成した日付けのみになっている．
しかし，その日以外であっても更新する．

基本は`diary.bash`を使って自動生成させている．

0000-00-00.mdというファイルは，更新の履歴を保存するための特別なフィルだ．
これは直接更新せず，`upload.bash`を通じて更新される．

In thid directory, all of articles are exist.

These file name is only date and extension .md.
Hoever, I will update anytime.

Each article file is generated by `diary.bash`.

History of updates are saved to 0000-00-00.md.
This file is updated by`upload.bash`.

md/0000-00-00.md
--------------------

これは更新履歴を保存する特殊なファイルで，更新の仕方が面白いので詳し目に紹介しておく．
中身は通常の記事と同様にタイトル部分と，そして更新履歴が新しいものから順番に書かれている．

もちろん自分で書く訳ではなく，`upload.bash`て自動生成される．
更新されたファイルを検知するのに`git diff --name-only master`を使用する．
そしてこれを使うために`git add --all`を使って全てをstagedにする．
もちろん手動ではなく`upload.bash`内でだ．

ところがこれを使ってそのまま0000-00-00.mdに追記すると一番古いものになってしまう．
だから，一度タイトルを抜いてから`tac`を使って逆順にして追記する．
そしてもう一度`tac`を使ってタイトルを戻してから，0000-00-00.mdに上書きする．

なんでこんな面倒なことをするのかというと，このファイル自体を他の記事と同様に扱いたいからだ．
このファイルはこれ自体からhtmlを生成するのと，`index.bash`の中で使うので，2回使われる．
でも更新は1回だけ．

This file saves a update history.
Ii do not write by myself. It is very troublesome.

History is new to old order.
Thus I cannot simply append new updates.
I explain how to update this history file.

History is generated by `upload.bash`.
Updates are reported from `git diff --name-only master` after `git add --all` in `upload.bash`.
First, extract a title by `head` and remove title by `tail`.
Then, reverse history by `tac` command and append update history from `git diff`.
Finally, reverse again by `tac` and append the extracted title to head.

Why I write such complex code.
Because, this Markdown is used in `index.bash` and `0000-00-00.html`.
But update is only once  in `upload.bash`.


html
----------------

中身は全ての記事のhtmlファイルだ．
mdディレクトリの中身を`pandoc`を使ってhtmlに自動変換させている．

そのルールについては`Makefile`の中に書かれている．
`make`コマンドを使って生成できるが，普段は`upload.bash`を使う．

たまに表示の確認とかする時に`make`を使う．

- `make`
- `make clean`
- `make index`
- `make hist`


`Makefile`の中では結構ごちゃごちゃしている．

やっていることの一つはタイトルの抽出と，タイトルの削除だ．
つまりMarkdownファイルの一行目をタイトルとし，`pandoc`にはそのタイトルを`--metadata title`として渡す．
そして，これで勝手にタイトルが付けられるから，重複しないように`pandoc`に渡す記事ファイルからは最初の二行を削除する．

また，もう一つは改行やスペース周りの調整だ．
英語であれば自然な動作なのだが，段落分けではない単なる一つの改行を入れると，`pandoc`は改行を半角スペースに変換する．
うっとうしいので，段落分けではな改行だけ`sed`で除去している．
そのルールが結構細かいのであんな面倒な表現になっているのだ．
まだ表には対応できていないと思う．


In this directory, there are html files generated from md files by `pandoc`.
Generating rules are written in `Makefile`.

I call `make` by `upload.bash`.
However, in some reasons, I use these commands below.

- `make`
- `make clean`
- `make index`
- `make hist`

`Makefile` seems to be very complex.

One task is to extract title from Markdown file and remove title in Markdown.
Markdown's first line is a title. Thus extract it and pass to `pandoc` by `--metadata title`.
However, this option also display title in html.
Therefore I have to remove from Markdown.

One task is to remove unnecessary space.
This is a special problem in Japanese or some languages.
It is natural behavior that convert newline to single space in English.
However in Japanese, it is unnecessary.
Thus I remove newline in Markdown by using `sed` and little bit complex option.
Because some markdown syntax needs newline.
This `Makefile` may not work well on Tabular.

ファイルの構成 (Files)
=============

しょうもないものから先に説明しておこう．

I explain from trivial files.

README.md
-----------

このファイルだ．

This file.

banner.html
---------------

これは全てのhtml/以下のファイルに，トップページに戻るためのリンクを付けるものだ．
単純にトップページへのリンクが書いてある．

これは`pandoc`の`-A`および`-B`を通じて，Bodyの前後に自動挿入される．
詳しくは`Makefile`を読めばわかるだろう．


This file is inserted into head and tail of all articles.
Thus, all aritcle's head and tail have a link to top page.

`pandoc` option `-A` and `-B` are called.
See `Makefile` for more details.

style.css
-----------

使ってないけどその内書くかも．

I do not use css now.


重要なファイル達(Important files)
===================

.nojekyll
--------------

これでjekyllを無効にできるらしい．

Disable jekyll. maybe.

diary.bash, upload.bash
---------------

`diary.bash` create file name by `date` command and open in `nvim`.

`upload.bash` detect file changes and append to update history,
generate html from Markdown, update index.bash, commit all changes and upload to GitHub.


index.bash, index.html
--------------

index.htmlはこのサイトのトップページ.
そして，`index.bash`はindex.htmlを生成するためのMarkdownを生成するbash scriptだ．

`index.bash`を実行すると，標準出力にMarkdownが流しこまれる．
これは単体では使わず，Makefileの中で使われる．

なんで自動生成するのかというと，更新履歴と記事一覧をメンテナンスするのが面倒だからだ．

index.html is a top page of this site.
`index.bash` generates index.html.

`index.bash` simply print Markdown to stdout.
I use this sscript in Makefile.

index.html contains a update history and a list of all articles.
Thus I generate automatically.


sitemap.bash, sitemap.xml
-------------------

サイトマップを作って登録し，Googleの検索に表示されるようにする．
`sitemap.bash`は`sitemap.xml`を自動で生成するためのスクリプト．
jekyllが出力したものを参考にして作成．

Generate `sitemap.xml` by `sitemap.bash` to register this web site with Google.
This script made with reference to jekyll's `sitemap.xml`.

Makefile
--------------

htmlの生成に使う．htmlの項目で詳しく説明した．
`index.html`．各記事のhtmlファイル．`sitemap.xml`が生成される．

Used to generate html. I explain before in html directory section.
Genearate `index.html`, html files of each articles and `sitemap.xml`.
