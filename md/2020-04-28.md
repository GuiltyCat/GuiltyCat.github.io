Googleの検索結果にGitHub Pagesを載せる (GitHub Pages on Google Search):Google Search Console:Google, Search, GitHub Pages
===================

中々このサイトがGoogle検索にかからないので，色々としてみた記録を残しておく．

まず`sitemap.xml`が必要だということで，`_config.yml`を一番上のディレクトリに置く．

内容は以下である．

```
plugins:
  - jekyll-sitemap
```

(追記:

但し，上の設定をしてしまうと，自動的にjekyllがMarkdownをhtmlに変換して表示してしまう．

普通に使うのであれば問題ないが，私は徹底的にカスタマイズしたい．
だから，上の方式ではなく自前で`sitemap.xml`を生成するスクリプトを書いた．
)

サイトを検索結果に表示させたいのであって，中身に興味はないので追いておく．

これで`https://{user_name}.github.io/sitemap.xml`にアクセスして，URL一覧が見れるようになった．

でお次はどうしろと書いてあったかというと，
Google Search Consoleに登録してインデクシングをしろとのことだった．

やり方がよく分からなかったが，とりあえず以下のURLで飛んでみると，オーナーですか？と聞かれるURLが出るのでクリックした．

```
site:https://{user_name}.github.io
```

するとプロパティタイプの選択というのが表示された．

そこでドメイン名である`{user_name.github.io}`をで確認を押すと，
ログインしてDNS設定をしろと出た．
そんな設定GitHub Pagesになかったぞ．

というわけで，URLプレフィックスで登録しておくことにした．

すると何やらgooglexxxxx.htmlを直下に置けとかいう指示があった．
言われた通りに置いて認証すると成功した．


さらにサイトマップを登録すればよいということだったので，左からサイトマップをクリックし，新しいサイトマップの追加を選択．
そして，先程`_config.yml`を追加することで生成された`sitemap.xml`を登録する．

ここまでは簡単にできたのだが，インデクシングにはもっと時間がかかるそうだ．
で，インデックスのカバレッジを見ると，

```
データを処理しています．1日後にもう一度ご確認下さい
```

いやいや，もう2日目ですけど．
なにやら1週間ぐらいかかるとか．
でもネットのニュースとか数分で検索結果に出ているのに．
こんな他の記事へのリンクを貼らない，へんちくりんなサイトは後回しということか．
もうちょっと待ってみることにする．

2020/04/29 AM
------------

であれから一日たったが，ついに検索結果に表示された．
ちなみに広告について文句を書いた[この記事](../html/2020-04-26.html)．
なんだけどMarkdownの方が登録されている．しかも，古い命名規則のMarkdownファイルの方だ．
だからリンク先が存在しない．

- 旧名と新名

```
20200426.md
2020-04-26.md
```

そっちじゃない．

しかもなんでhtmlじゃなくてMarkdownなんだよ．
Markdownのリンクはindex.htmlに貼ってないから`sitemap.xml`にも載ってないのに．

トップページより先に，生Markdownだけ公開されてしまいました．


2020/04/29 AM
------------

あれから色々と探っていると，mdだけ登録された理由が分かった．

Googleは`sitemap.xml`が更新されても自分からは見に行かないようだ．
だから古いサイトを登録しようとしてしまったようだ．

ここで問題だったのはjekyllがmdから自動でhtmlを作成していたのだ．
だから，mdからjekyllが自動生成したhtmlがmd/xx.htmlとして，
私が`mnake`でmdから自動で生成したhtmlがhtml/xx.htmlとして登録されていた．

つまり同じようなサイトが二つ存在していたのだ．
そしてGoogleは`sitemap.xml`の最初に載っていた，md/xx.htmlの方を見に行ったと思われる．

ここで問題なのが，`sitemap.xml`からクロールする先を見にいったタイミングで，私がページの命名規則を変更し，アップロードしていたようなのだ．
だから，`sitemap.xml`に登録されていたファイルが見つからなくなり，インデクシングに失敗していたのだ．

Googleちゃんは正しく動いてくれていたのに，私の対応が悪かったのだ．

2020/05/02 AM
---------

あれから`site:<URL>`を使って検索してみると，今度は`banner.html`という，上下に貼る共通のリンクが追加された．
何故メインコンテンツをインデックスに追加してくれないのか．

また，色々と調査した結果，トップページだけをクロールしてもらうように，Googleにお願いすることにした．
方法は`URL検査ツール`を使用し，インデックス登録をリクエストを送るのだ．
これはGoogle Search Console内からできる．

2020/05/02 PM
-----------

`site:<URL>`で確認してみるとちゃんと検索結果に現れた．

しかし，カバレッジとか見てみるときちんと反映されていない．
なので，URL検査からクロールをお願いしたものだけクロールして，
サイトマップは確認していないのだろう．
まあ，検索結果に出さえすればいいので，大した問題ではない．
今後Googleがちゃんとサイトマップを見て辿ってくれるだろう．
これからはGoogle Search COonsoleを見ることはないだろう．

Googleさんありがとう．

