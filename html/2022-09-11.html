<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WgetやCurlでダウンロードできない場合の対処法:</title>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
</head>
<style>
code {
    font-size: 1rem;
}
@media (max-width: 768px) {
    code {
        font-size: 4vw;
    }
}
</style>
<body>
<a href="../index.html">トップ(TOP)</a>
<h1 id="WgetやCurlでダウンロードできない場合の対処法:">WgetやCurlでダウンロードできない場合の対処法:</h1>

<h2 id="目次 (Table of Contents)">目次 (Table of Contents)</h2>

<ul>
<li> 初回アクセス時にクッキーが発行される場合
</li>
</ul>

<p>
WgetやCurlでダウンロードできない場合がある．分かりやすいのは，ブラウザからアクセスした時にチェックしています的な画面が出た時だ．
</p>

<p>
所詮HTTPなので何とか彼んとかできなくはない．
</p>


<p>
対処法がいくつかあってそれらはヘッダーで何とかなる場合もある．
</p>

<h2 id="初回アクセス時にクッキーが発行される場合">初回アクセス時にクッキーが発行される場合</h2>

<p>
この手のサイトはブラウザからのアクセス時にCookieを残して，その情報を元に判定していることがある．
</p>

<p>
例えばとあるサイトではcf_clearanceとかcsrftokenとかを保存したりする．
</p>

<p>
これを確認するにはブラウザの設定からそのサイトのCookie情報を表示させればよい．これらはWgetの場合次のように設定する．
</p>

<pre><code>
wget --header "cookie: cf_clearance=<...>; csrftoken=<...>"
</code></pre>

<p>
ここに入る値はブラウザ上で表示されたCookie情報である．
</p>

<p>
ここでさらに，ブラウザのUserAgentとwgetのUserAgentを一致させないといけない場合がある．そういった場合はWiresharkとかを使ってHTTP通信を除き，そのヘッダーからUAを見てコピペすればよい．
</p>

<p>
なのでUserAgentも合わせる場合はこんな感じで指定することになる．
</p>

<pre><code>
wget -U "<...>" --header "cookie: cf_clearance=<...>; csrftoken=<...>"
</code></pre>

<p>
UserAgentというのは"Mozilla/5.0 (X11....)"みたいな文字列だ．
</p>
<br>
<a href="../index.html">トップ(TOP)</a>
</body>
</html>
