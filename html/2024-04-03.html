<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>音を作る言語を作りたい</title>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
</head>
<body>
<a href="../index.html">トップ(TOP)</a>
<h1 id="音を作る言語を作りたい">音を作る言語を作りたい</h1>

<h2 id="目次 (Table of Contents)">目次 (Table of Contents)</h2>



<p>
2024/04/03

</p>

<p>
人工音声や音楽を作る言語を作りたい．
</p>

<p>
巷では深層学習を使って，人の声をベースに自然な発音をさせたり，あるいは，ボイスチェンジャーのように声を別の人の声に変換したりと様々な方法がある．
</p>

<p>
でも，私が作りたいのはもっと人工的で理論的な例えばフォルマントを活用した人工音声作成だ．なぜならコテコテにチューニングできるからだ．その上で伸びやかな声で色々としゃべらせたり歌わせたりしてみたい．
</p>

<p>
その一方で，簡単な作曲とかもしてみたいと考えている．つまり，作曲で音を作りつつそれを人工音声で歌ってみるとかできたらいいなと．
</p>

<p>
ここでいくつかやりたいことが見えてくる．まずは作曲をしたいので，基本的な楽譜を書けるようにする必要がある．
</p>

<p>
さらに，楽器を割り当てたり，あるいはビブラートとか変調とか，音の大きさを変化させたりだとか，そうした装飾的なことを後から自在に編集できるようにしたい．
</p>

<p>
すると，こんなことがしたい．
</p>


<ol>
<li> 楽譜を書ける
</li>
<li> 楽器の音セットを作れる
</li>
<li> 音量やビブラートなどの修飾を後から追加できる
</li>
</ol>

<p>
まあ，ありもののソフトを組み合わせたらできるんだろうけれども，ここはちょっとオリジナルで作ってみたくなってしまった．
</p>

<p>
色々とアイディアはあるが，記述方法が面倒臭すぎたり，理論的にはきれいだけどちょっと実用したくはないだったりで，中々落し所が見つかっていない．
</p>

<p>
というわけで，せっかくなのでこの記事を使ってそのあたりの考えをまとめていければなと思っている．
</p>

<p>
まずは最初ということで，これぐらいにしておく．
</p>

<p>
2024/04/04

</p>

<p>
音を作る要素はいくつかある．フーリエ変換から分かる通り，理論上は単純なsin波の組み合わせで全ての音を作ることができる．しかし，実際にはそんな面倒な手法で音楽を作ったりはしない．
</p>

<p>
音楽の3要素として上げられるのが以下である．
</p>

<ul>
<li> リズム
</li>
<li> メロディ
</li>
<li> ハーモニー
</li>
</ul>

<p>
ここで問題になるのが，この3つの要素がひっついて音楽になっているため，この3つを同時に記述する必要があるということだ．
</p>

<p>
例えば単線律であればその音の高さと長さを順番に書いていくだけでよい．しかし，ハーモニになったり，あるいはバッハのように複数のメロディが同時進行したり，さらにはそれらが交差した場合にはどう記述するかが難しい．
</p>

<p>
なぜなら，単旋律であれば一つの音を記述すれば，基本的にはその後ろにしか音が現れることがない．つまり記述上前から読んでいって時間を遡ることがない．
</p>

<p>
したがって，ハーモニーを構成する場合，あるメロディに紐付くものは同時にならすなどブロック構造を持たせる．そして，異なるメロディを裏で流したい場合には時間を巻き戻して記述をすることが必要になる．そうしないと，複数のメロディをハーモニーの形で記述するとごちゃごちゃしすぎて何を書いているのか分からなくなるからだ．
</p>

<p>
しかし，このような記述法はある音楽を表現しようとした時に複数の表現方法があることを意味する．こういうことを許すとコーディング規約みたいな面倒な流派を作り出してしまうため避けたい．(とはいっても妥協するだろうが)

</p>


<p>
さて，ここまでは音楽を作るのに必要な要素を説明した．ここからは，楽器の音を作ることにフォーカスする．
</p>

<p>
単純に言えばシンセサイザーの真似をすればいいっちゃいいのかもしれない．
</p>

<p>
楽器の音を作りたい場合，ある音の高さ，長さをした時にどのような形状の波形を生成するかを決めることに他ならない．更に，楽器に特定の特性があってそれをパラメータで指定したい場合には，上記パラメータに加えてその特性パラメータも含められるようにする必要がある．
</p>

<p>
こういうことをしたい場合，プログラマー的には横着をしたくなる．つまり音の高さパラメータfと長さlに対して，数式的に楽器を記述する方法だ．当面はこれを採用することになるだろう．ただし，実際の楽器の場合特定の音だと共鳴が強まるなど，単にfとlを連結したような単純な音にはならない．こういうマニアックなこともできるようにはしておきたい．
</p>

<p>
この場合fやlを含めた複数のパラメータを取得し，ある時刻tにおける波形の振幅を出力する関数を定義できること．さらに，その関数にtを入力し実際の波形配列を取得するこの2段階に分かれる．
</p>

<p>
この時シンセイサイザーのようにエンウ゛ェロープを持ってこないと，音と音の繋ぎで信号が連続的でなくなるのでブチッとした強烈な音が発生する．イメージとしてはパルス波を流し込むようなもので，周波数領域の広い範囲にバツッとパワーが入ってしまう．
</p>


<p>
次に，音楽を修飾する要素についても説明する．
</p>

<p>
上記で楽器の要素で実際の波形配列を生成すると書いたが，実際のユースケースを考えると，楽器の音を入れ換えるのではなくその楽器の音のままでビブラートを入れたり，あるいは音量を連続的に変化させたりといった処理を入れたなくなる．
</p>

<p>
単純に音量を変化させるだけでよければ，振幅を変化させるだけでよいので，ある関数を掛ければよい．しかし，周波数領域でビブラートを掛けたいとなるとちょっと面倒なことになる．
</p>

<p>
一応取得できた配列の間を補完すれば，擬似的に高解像度な信号になるため，その信号をベースにtを揺らすことで擬似的にfを揺らすことができる．
</p>

<p>
ただより厳密にそして美しく実装するのであれば，上記楽器の音を生成する場合に最初からfをf(t)のように時間に依存して変化するfにしておく方がよい．
</p>

<p>
この場合，コンパイルする時に初めて楽器の音の詳細が決まるという，中々アクロバティックかつダイナミックなことになる．
</p>

<p>
単純な音でよければいいが，どんどん音を重ねたりした場合にこれで成立するのかがちょっと心配になる．
</p>

<p>
とりあえず今日はここまで．次からは，実際の楽器の記述法，音楽の記述法について触れていきたい．まだまだ理想のあり方だったり一般論を述べているだけで，中々具体的な実装や仕様にまで踏み込めていないが，さらに言えばずっと前からメモや頭の中には考えていたことを後追いでチョビチョビ出しているだけだが，こうやってとりとめもなく書き連ねていくと進んでいる気がしてくる．
</p>

<p>
2024/04/06

</p>

<p>
ここからは実際にどんな記述方法がよいのかを考えていく。
音楽の書き方を先に考え、その後に楽器の書き方を考えることにする。

</p>

<p>
まず音楽については、単旋律の書き方から順番にハーモニーの書き方、複旋律の書き方へと繋げていく。

</p>

<p>
単旋律については、リズムとメロディを記載することとする。そして音量については装飾という扱いにする。
また、アクセントやスタカートなどある特定の音については特別な装飾とする。

</p>

<p>
さらに、休符は無音の音とし、ある音の終了は次の音の開始とする。

</p>

<p>
すると、ある単旋律は音の高さと長さを書き連ねたものとなる。

</p>

<p>
音の高さは周波数で表してもよいが、後から変調したくなることもあるので、
アルファベットでABCDEFGとし、オクターブシフトをアルファベットの前に、
フラットやシャープ、ダブルフラットやダブルシャープはアルファベットの後に持ってくる。

</p>

<p>
オクターブシフトの表記方法は真ん中を基準に0とし、下げればマイナス、上げればプラスとする。

</p>

<p>
つまりこのような感じ。

</p>

<pre><code>
<number>={0|1|2|3|4|5|6|7|8|9}
<pitch>={+|-}?{<number>}+{A|B|C|D|E|F|G}{#|##|b|bb}*
</code></pre>


<p>
音の長さは全音符を1とし、二分音符、四分音符を順番に1/2、1/4と表記する。
また、3連符などは4分音符の3連符であれば1音は12になるので1/12と表記する。
付点については、3/4のように分数で表記する。

</p>

<p>
タイなどは一旦はなしにし、必要なだけ伸ばすこととする。
したがって全音符より長い音にしたければ2、3のように伸ばしていけばよい。1以上の分数も許される。

</p>

<p>
まとめるとこんな感じ。

</p>

<pre><code>
<natural number>={1|2|3|4|5|6|7|8|9}
<length>={<natural number>}+{/}?{<natural number>}*
</code></pre>

<p>
ここまでをまとめると，ある単旋律のメロディは次のように記述できる．
</p>

<pre><code>
<single note>=<pitch><length>
<delimiter>={,| }
<simple melody>=<single note>{<delimiter><single note>}*
</code></pre>

<p>
2024/04/07

</p>


<p>
次にハーモニーの書き方について。

</p>


<p>
ハーモニーはあるメロディに紐付いて，そのメロディの厚みを増すために鳴らすために使われたりする．この考えに沿って，次のように記述する

</p>

<pre><code>
<harmoney>={[}<single note>{<delimiter><single note>}*{]}
</code></pre>

<p>
単純に括弧で囲むだけである．そして重要なことは，このハーモニーの音の長さは，一番最初に記述した音の長さである．
</p>

<p>
したがって，一番最初の音よりもさらに長い音を書くと次のメロディの音に重なることになる．
</p>

<p>
ちょっと前に紹介した単旋律の記法では，前の音の終わりが次の音の始まりになる．すると，例えばちょっとずつ前の音と重ねながら鳴らすとかしようとするとちょっと面倒．
</p>

<p>
後で出てくる複旋律の記法で対処する手もあるが，こうした場合は同じメロディとして書きたくなる．そうした場合に使える小手先のテクニックとして，ハーモニーが使える．
</p>

<p>
一番最初の音を休符にしたハーモニーを作れば，休符は音が鳴らないので休符ベースでメロディを進行させられる．したがって，音の先頭は規定されるが後ろの長さや重ね方は自由にできる．
</p>

<p>
これらを合わせると次のようになる．
</p>

<pre><code>
<note>={<single note>|<harmoney>}
<harmony melody>=<note>+
</code></pre>


<p>
今度は複旋律の書き方について．
</p>

<p>
これはややこしいが，メロディの中にマークを入れ，後からそのマークを参照すると，そのマークの時間を基準にメロディを開始できるようにする．
</p>

<p>
いってみれば，メロディの中で基準としたい音を選択しマークする．これはメロディの先頭であってもいいし，中間であってもいい．そして，そのマークを後で参照すると，それ以降に記述されたメロディはマークされた音から重なるように配置される．
</p>

<p>
この機能により，一つのファイルの中であっても複数のメロディを同時に記述することができる．
</p>


<pre><code>
<label>={a|b|...|Y|Z}+
<mark>={&}<label><delimiter><note>
<jump>={@}<label><delimiter><note>
</code></pre>

<p>
この時，マークされた音とジャンプの音は同じ基準から開始することになる．より厳密には，ジャンプの音は事前に設定された，単旋律の音の中でマークされた音の開始位置と同じ位置から開始する．実装が面倒になりそうなので，必ずマークが先に記述されている必要があることにする．
</p>

<p>
同じラベルのマークが複数現れてはいけないが，同じラベルのジャンプは複数現れてもよい．
</p>

<p>
これで大体の音楽が作れるようになってきたと思う．後は修飾と楽器の作り方．早く楽器の作り方にまでいきたいが，修飾の書き方を終わらせようか．といっても，後から色々とやりたいことが増えるのと，楽器の作り方を先にしないと説明しにくい部分があるので，合計で2回か3回書くことになるかも．(最初，楽器の説明の後，まとめ)

</p>

<p>
今日はここまで．
</p>
<br>
<a href="../index.html">トップ(TOP)</a>
</body>
</html>
