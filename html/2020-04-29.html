<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Makefileについて誤解していたこと:Diary, Makefile</title>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
</head>
<body>
<a href="../index.html">トップ(TOP)</a>
<h1 id="Makefileについて誤解していたこと:Diary, Makefile">Makefileについて誤解していたこと:Diary, Makefile</h1>

<p>
Makefileはこの記事の自動生成でも使用してるが，中々便利なものだ．
</p>

<p>
記述の基本はターゲットと依存を書き，その下にタブで始まる処理内容を書くというものだ．
</p>

<pre><code>
Target:Dependency
	Process
</code></pre>

<p>
そして，一々全てのファイル名を記述するのは面倒な時がある．だから，そういう時のために特殊変数が用意されている．
</p>

<p>
例えば，あるMarkdownからhtmlを作成したいとする．この時以下のように書くことで，勝手に名前を当て嵌めてくれる．
</p>

<pre><code>
html/%.html:md/%.md
	pandoc -f markdown -t html -o $@ $< 
</code></pre>

<p>
この時，<code>%</code>記号は同じ一つの名前を表わす．そして，<code><span class="math inline">\(<</code>は依存ファイルの最初のファイル名を，<code>\)</span>@</code>はターゲット名を表す．
</p>

<p>
今まで勘違いしていなのは，この<code>%</code>が全てのファイルの羅列と同義であると思い，<code>$<</code>というのは依存関係にある全てを処理すると思っていたことだ．
</p>

<p>
だから，依存関係にはあるが内部で処理をしないファイルの扱い方が分からなかったのだ．例えばC言語のヘッダーなんかは，依存関係にはあるがヘッダだけでコンパイルはしないので，この表現では使えないと思っていたのだ．
</p>

<p>
しかし，実際にはそんな動作はしておらず，<code>%</code>は一つのファイルを示している．そして<code>$<</code>は依存関係の一番先頭にあるファイルだけを示す．
</p>

<p>
だから，以下のように書いても<code>style.css</code>は<code>$<</code>にはならず，処理されない．
</p>

<pre><code>
html/%.html:md/%.md style.css
	pandoc -f markdown -t html -o $@ $< 
</code></pre>

<h2 id="最後に">最後に</h2>

<p>
いやー，ずっと長いこと使っていたのにこんなことも知らなかったとは．サクッと調べると，確かに<code>$<</code>の説明は先頭のファイルと書いていたが，華麗に読み飛ばしてしまっていた．
</p>

<p>
でも，Makefileとgccにはまだ-MD，-MMDや.dファイルという，まだ理解しきれていなオプションや書き方があるので，いずれまとめたい．
</p>

<p>
にしても，こういうMakefileのテンプレートってなかなかいいのが見つからない．汚い書き方をしていたり，モダンな書き方じゃなかったり．
</p>

<p>
この記事を生成するMakefileだって人のことを言えたものではないが，その内エレガントに仕上げていきたいな．
</p>
<a href="../index.html">トップ(TOP)</a>
</body>
</html>
